<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>X-ray Machine Desk Review Form - CSV Dynamic</title>

<!-- CSV Parser Library from CDN -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  :root {
    --primary-color: #2563eb;
    --primary-hover: #1d4ed8;
    --secondary-color: #10b981;
    --danger-color: #ef4444;
    --warning-color: #f59e0b;
    --bg-light: #f8fafc;
    --bg-white: #ffffff;
    --border-color: #e2e8f0;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
    --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
    --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
    --bullseye-color: #3b82f6;
    --aimed-color: #8b5cf6;
    --ge-color: #ec4899;
  }
  
  * {
    box-sizing: border-box;
  }
  
  body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 20px;
    margin: 0;
    min-height: 100vh;
  }
  
  .container {
    max-width: 1400px;
    margin: 0 auto;
  }
  
  h1 {
    text-align: center;
    color: white;
    font-size: 2.5em;
    margin-bottom: 10px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
  }
  
  .subtitle {
    text-align: center;
    color: rgba(255,255,255,0.9);
    font-size: 1.1em;
    margin-bottom: 30px;
  }
  
  #loadingMessage {
    text-align: center;
    color: white;
    font-size: 1.3em;
    padding: 40px;
    background: rgba(255,255,255,0.1);
    border-radius: 12px;
    margin: 20px auto;
    max-width: 600px;
  }
  
  #errorMessage {
    text-align: center;
    color: white;
    font-size: 1.2em;
    padding: 30px;
    background: rgba(239, 68, 68, 0.9);
    border-radius: 12px;
    margin: 20px auto;
    max-width: 800px;
    display: none;
  }
  
  form { 
    background: var(--bg-white);
    padding: 40px;
    border-radius: 20px;
    box-shadow: var(--shadow-lg);
    display: none;
  }
  
  form.loaded {
    display: block;
  }
  
  .intro { 
    background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 30px;
    border-left: 5px solid var(--primary-color);
  }
  
  .intro h3 {
    margin-top: 0;
    color: var(--primary-color);
    font-size: 1.3em;
  }
  
  .rating-scale {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 12px;
    margin-top: 15px;
  }
  
  .rating-scale-item {
    background: white;
    padding: 12px;
    border-radius: 8px;
    text-align: center;
    border: 2px solid var(--border-color);
    transition: transform 0.2s;
  }
  
  .rating-scale-item:hover {
    transform: translateY(-2px);
    border-color: var(--primary-color);
  }
  
  .rating-scale-item .score {
    font-size: 1.5em;
    font-weight: bold;
    color: var(--primary-color);
  }
  
  .rating-scale-item .label {
    font-size: 0.9em;
    color: var(--text-secondary);
    margin-top: 4px;
  }
  
  .reviewer-info {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
    padding: 25px;
    background: var(--bg-light);
    border-radius: 12px;
  }
  
  .reviewer-info label {
    display: block;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 8px;
    font-size: 0.95em;
  }
  
  input[type="text"], 
  input[type="date"] { 
    width: 100%;
    padding: 12px 16px;
    border-radius: 8px;
    border: 2px solid var(--border-color);
    font-size: 1em;
    transition: border-color 0.3s, box-shadow 0.3s;
  }
  
  input[type="text"]:focus, 
  input[type="date"]:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }
  
  .section { 
    margin: 40px 0;
    padding: 30px;
    border-radius: 16px;
    background: white;
    border: 2px solid var(--border-color);
    box-shadow: var(--shadow-sm);
  }
  
  .section-title {
    margin: 0 0 25px 0;
    color: var(--text-primary);
    font-size: 1.8em;
    padding-bottom: 15px;
    border-bottom: 3px solid var(--primary-color);
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .section-title::before {
    content: "üìä";
    font-size: 1.2em;
  }
  
  .question { 
    margin-bottom: 35px;
    padding: 25px;
    border-radius: 12px;
    background: var(--bg-light);
    border: 1px solid var(--border-color);
  }
  
  .question-header {
    margin-bottom: 20px;
  }
  
  .question-header p {
    font-size: 1.15em;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 10px 0;
  }
  
  .spec {
    display: inline-block;
    background: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.9em;
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
    font-style: italic;
  }
  
  .machine-notes { 
    background: white;
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    border-left: 4px solid var(--secondary-color);
  }
  
  .machine-notes-title {
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 12px;
    font-size: 1em;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .machine-notes-title::before {
    content: "‚ÑπÔ∏è";
  }
  
  .specs-grid {
    display: grid;
    gap: 12px;
    margin-top: 12px;
  }
  
  .spec-item {
    display: grid;
    grid-template-columns: 200px 1fr;
    gap: 15px;
    padding: 12px;
    background: var(--bg-light);
    border-radius: 8px;
    align-items: center;
  }
  
  .spec-machine {
    font-weight: 700;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .spec-machine.bullseye::before {
    content: "‚óè";
    color: var(--bullseye-color);
    font-size: 1.5em;
  }
  
  .spec-machine.aimed::before {
    content: "‚óè";
    color: var(--aimed-color);
    font-size: 1.5em;
  }
  
  .spec-machine.ge::before {
    content: "‚óè";
    color: var(--ge-color);
    font-size: 1.5em;
  }
  
  .spec-value {
    color: var(--text-secondary);
    line-height: 1.5;
  }
  
  .ratings-container {
    margin-top: 20px;
  }
  
  .ratings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 20px;
  }
  
  .machine-rating {
    background: white;
    padding: 20px;
    border-radius: 12px;
    border: 3px solid var(--border-color);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .machine-rating::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
  }
  
  .machine-rating.bullseye {
    border-color: var(--bullseye-color);
  }
  
  .machine-rating.bullseye::before {
    background: linear-gradient(90deg, var(--bullseye-color), #60a5fa);
  }
  
  .machine-rating.aimed {
    border-color: var(--aimed-color);
  }
  
  .machine-rating.aimed::before {
    background: linear-gradient(90deg, var(--aimed-color), #a78bfa);
  }
  
  .machine-rating.ge {
    border-color: var(--ge-color);
  }
  
  .machine-rating.ge::before {
    background: linear-gradient(90deg, var(--ge-color), #f472b6);
  }
  
  .machine-rating:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-md);
  }
  
  .machine-rating-title { 
    font-weight: 700;
    font-size: 1.1em;
    margin: 10px 0 15px 0;
    color: var(--text-primary);
    text-align: center;
  }
  
  .scale-options { 
    display: flex;
    justify-content: space-between;
    gap: 8px;
    margin-top: 12px;
  }
  
  .scale-options label {
    flex: 1;
    position: relative;
  }
  
  .scale-options input[type="radio"] {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }
  
  .scale-options label span {
    display: block;
    padding: 12px 8px;
    text-align: center;
    font-weight: 600;
    font-size: 1.1em;
    border-radius: 8px;
    background: var(--bg-light);
    border: 2px solid var(--border-color);
    cursor: pointer;
    transition: all 0.2s ease;
    user-select: none;
  }
  
  .scale-options label:hover span {
    border-color: var(--primary-color);
    transform: translateY(-2px);
  }
  
  .scale-options input[type="radio"]:checked + span {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    transform: scale(1.05);
  }
  
  .scale-legend {
    display: flex;
    justify-content: space-between;
    margin-top: 8px;
    font-size: 0.75em;
    color: var(--text-secondary);
    padding: 0 4px;
  }
  
  .submit-row { 
    text-align: center;
    margin-top: 40px;
    padding-top: 30px;
    border-top: 2px solid var(--border-color);
  }
  
  button[type="submit"] { 
    padding: 16px 48px;
    border: none;
    border-radius: 12px;
    background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
    color: white;
    font-size: 1.2em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  
  button[type="submit"]:hover { 
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
  }
  
  button[type="submit"]:active {
    transform: translateY(0);
  }
  
  .progress-indicator {
    position: sticky;
    top: 20px;
    background: white;
    padding: 15px;
    border-radius: 12px;
    box-shadow: var(--shadow-md);
    margin-bottom: 20px;
    z-index: 100;
  }
  
  .progress-bar {
    height: 8px;
    background: var(--bg-light);
    border-radius: 10px;
    overflow: hidden;
  }
  
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
    width: 0%;
    transition: width 0.3s ease;
  }
  
  .progress-text {
    text-align: center;
    margin-top: 8px;
    font-size: 0.9em;
    color: var(--text-secondary);
    font-weight: 600;
  }
  
  @media (max-width: 768px) {
    body {
      padding: 10px;
    }
    
    form {
      padding: 20px;
    }
    
    h1 {
      font-size: 1.8em;
    }
    
    .ratings-grid {
      grid-template-columns: 1fr;
    }
    
    .scale-options label span {
      padding: 10px 4px;
      font-size: 0.95em;
    }
    
    .spec-item {
      grid-template-columns: 1fr;
      gap: 8px;
    }
  }
  
  @media print {
    body {
      background: white;
      padding: 0;
    }
    
    .submit-row {
      display: none;
    }
  }
</style>
</head>
<body>
<div class="container">
  <h1>üè• X-ray Machine Desk Review</h1>
  <p class="subtitle">Comprehensive Rating & Comparison Form</p>
  
  <div id="loadingMessage">
    ‚è≥ Loading questions from CSV file...
  </div>
  
  <div id="errorMessage"></div>
  
  <form id="reviewForm">
    <div class="progress-indicator">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-text" id="progressText">0% Complete</div>
    </div>
    
    <div class="intro">
      <h3>üìã Rating Instructions</h3>
      <p><strong>How to rate:</strong> For every question, give a score from <strong>0 to 5</strong> for each machine based on the specifications provided.</p>
      <div class="rating-scale">
        <div class="rating-scale-item">
          <div class="score">0</div>
          <div class="label">Very Bad</div>
        </div>
        <div class="rating-scale-item">
          <div class="score">1</div>
          <div class="label">Bad</div>
        </div>
        <div class="rating-scale-item">
          <div class="score">2</div>
          <div class="label">Okay</div>
        </div>
        <div class="rating-scale-item">
          <div class="score">3</div>
          <div class="label">Good</div>
        </div>
        <div class="rating-scale-item">
          <div class="score">4</div>
          <div class="label">Very Good</div>
        </div>
        <div class="rating-scale-item">
          <div class="score">5</div>
          <div class="label">Excellent</div>
        </div>
      </div>
    </div>
    
    <div class="reviewer-info">
      <div>
        <label>üë§ Reviewer Name</label>
        <input type="text" name="reviewer_name" placeholder="Enter your full name" required>
      </div>
      <div>
        <label>üíº Role / Position</label>
        <input type="text" name="reviewer_role" placeholder="Enter your role" required>
      </div>
      <div>
        <label>üìÖ Review Date</label>
        <input type="date" name="review_date" required>
      </div>
    </div>

    <!-- Dynamic content will be inserted here -->
    <div id="questionsContainer"></div>

    <div class="submit-row">
      <button type="submit">üì§ Submit Review</button>
    </div>
  </form>
</div>

<script>
// ========================================
// CONFIGURATION
// ========================================

// CSV file name (must be in the same folder as this HTML file)
const CSV_FILE_NAME = 'Xray_Evaluation_Questions_Simple.csv';

// CSV Column Mapping
// These correspond to the headers in your CSV file
// Modify these if your CSV headers change
const CSV_COLUMNS = {
  CATEGORY: "What it's about",           // Column 0: Section/Category name (note: special apostrophe)
  CRITERIA: "What to check",              // Column 1: Evaluation criteria
  QUESTION: "Your rating question (0‚Äì5)", // Column 2: The rating question text (note: en-dash not hyphen)
  BULLSEYE_SPEC: "BullsEye machine (what the papers say)", // Column 3: BullsEye specs
  AIMED_SPEC: "Aimed machine (what the papers say)",       // Column 4: Aimed specs
  GE_SPEC: "GE machine (what the papers say)"              // Column 5: GE specs
};

// Machine configuration
const MACHINES = [
  { id: 'bullseye', name: 'BullsEye ‚Äì SG Jumong + DRTECH', colorClass: 'bullseye' },
  { id: 'aimed', name: 'Aimed ‚Äì Carestream Horizon + Trimax', colorClass: 'aimed' },
  { id: 'ge', name: 'GE ‚Äì Definium Pace Select + FlashPad', colorClass: 'ge' }
];

// ========================================
// MAIN APPLICATION
// ========================================

let questionCounter = 0;

// Load and parse CSV file on page load
window.addEventListener('DOMContentLoaded', function() {
  loadCSVData();
  
  // Set today's date as default
  document.querySelector('input[name="review_date"]').valueAsDate = new Date();
});

/**
 * Fetch and parse the CSV file
 */
function loadCSVData() {
  Papa.parse(CSV_FILE_NAME, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      if (results.errors.length > 0) {
        showError('Error parsing CSV file: ' + results.errors[0].message);
        return;
      }
      
      if (results.data.length === 0) {
        showError('CSV file is empty or has no data rows.');
        return;
      }
      
      // Generate form from CSV data
      generateForm(results.data);
      
      // Hide loading, show form
      document.getElementById('loadingMessage').style.display = 'none';
      document.getElementById('reviewForm').classList.add('loaded');
    },
    error: function(error) {
      showError('Failed to load CSV file. Make sure "' + CSV_FILE_NAME + '" is in the same folder. Error: ' + error.message);
    }
  });
}

/**
 * Generate the form questions from CSV data
 */
function generateForm(data) {
  const container = document.getElementById('questionsContainer');
  
  // Group questions by category
  const groupedData = groupByCategory(data);
  
  // Create sections for each category
  Object.keys(groupedData).forEach(category => {
    const section = createSection(category, groupedData[category]);
    container.appendChild(section);
  });
  
  // Initialize progress tracking
  initializeProgressTracking();
}

/**
 * Group CSV rows by category
 */
function groupByCategory(data) {
  const grouped = {};
  
  data.forEach(row => {
    const category = row[CSV_COLUMNS.CATEGORY] || 'General';
    
    if (!grouped[category]) {
      grouped[category] = [];
    }
    
    grouped[category].push(row);
  });
  
  return grouped;
}

/**
 * Create a section element with questions
 */
function createSection(categoryName, questions) {
  const section = document.createElement('div');
  section.className = 'section';
  
  const title = document.createElement('h2');
  title.className = 'section-title';
  title.textContent = categoryName;
  section.appendChild(title);
  
  questions.forEach(questionData => {
    const questionDiv = createQuestion(questionData);
    section.appendChild(questionDiv);
  });
  
  return section;
}

/**
 * Create a question element with machine ratings
 */
function createQuestion(data) {
  questionCounter++;
  
  const questionDiv = document.createElement('div');
  questionDiv.className = 'question';
  
  // Question header
  const header = document.createElement('div');
  header.className = 'question-header';
  
  const questionText = document.createElement('p');
  questionText.innerHTML = `<strong>Q${questionCounter}.</strong> ${data[CSV_COLUMNS.QUESTION]}`;
  header.appendChild(questionText);
  
  const criteriaSpan = document.createElement('span');
  criteriaSpan.className = 'spec';
  criteriaSpan.textContent = `üìå Evaluation Criteria: ${data[CSV_COLUMNS.CRITERIA]}`;
  header.appendChild(criteriaSpan);
  
  questionDiv.appendChild(header);
  
  // Machine specifications
  const machineNotes = createMachineNotes(data);
  questionDiv.appendChild(machineNotes);
  
  // Rating inputs for each machine
  const ratingsContainer = document.createElement('div');
  ratingsContainer.className = 'ratings-container';
  
  const ratingsGrid = document.createElement('div');
  ratingsGrid.className = 'ratings-grid';
  
  MACHINES.forEach(machine => {
    const ratingCard = createMachineRating(machine, questionCounter);
    ratingsGrid.appendChild(ratingCard);
  });
  
  ratingsContainer.appendChild(ratingsGrid);
  questionDiv.appendChild(ratingsContainer);
  
  return questionDiv;
}

/**
 * Create machine specifications display
 */
function createMachineNotes(data) {
  const notesDiv = document.createElement('div');
  notesDiv.className = 'machine-notes';
  
  const title = document.createElement('div');
  title.className = 'machine-notes-title';
  title.textContent = 'Machine Specifications';
  notesDiv.appendChild(title);
  
  const specsGrid = document.createElement('div');
  specsGrid.className = 'specs-grid';
  
  // BullsEye spec
  if (data[CSV_COLUMNS.BULLSEYE_SPEC]) {
    specsGrid.appendChild(createSpecItem('bullseye', 'BullsEye', data[CSV_COLUMNS.BULLSEYE_SPEC]));
  }
  
  // Aimed spec
  if (data[CSV_COLUMNS.AIMED_SPEC]) {
    specsGrid.appendChild(createSpecItem('aimed', 'Aimed', data[CSV_COLUMNS.AIMED_SPEC]));
  }
  
  // GE spec
  if (data[CSV_COLUMNS.GE_SPEC]) {
    specsGrid.appendChild(createSpecItem('ge', 'GE', data[CSV_COLUMNS.GE_SPEC]));
  }
  
  notesDiv.appendChild(specsGrid);
  return notesDiv;
}

/**
 * Create a single specification item
 */
function createSpecItem(colorClass, machineName, specValue) {
  const item = document.createElement('div');
  item.className = 'spec-item';
  
  const machineDiv = document.createElement('div');
  machineDiv.className = `spec-machine ${colorClass}`;
  machineDiv.textContent = machineName;
  item.appendChild(machineDiv);
  
  const valueDiv = document.createElement('div');
  valueDiv.className = 'spec-value';
  valueDiv.textContent = specValue;
  item.appendChild(valueDiv);
  
  return item;
}

/**
 * Create machine rating card with radio buttons
 */
function createMachineRating(machine, questionNum) {
  const card = document.createElement('div');
  card.className = `machine-rating ${machine.colorClass}`;
  
  const title = document.createElement('div');
  title.className = 'machine-rating-title';
  title.textContent = machine.name;
  card.appendChild(title);
  
  const scaleOptions = document.createElement('div');
  scaleOptions.className = 'scale-options';
  
  // Create radio buttons 0-5
  for (let i = 0; i <= 5; i++) {
    const label = document.createElement('label');
    
    const radio = document.createElement('input');
    radio.type = 'radio';
    radio.name = `q${questionNum}_${machine.id}`;
    radio.value = i;
    if (i === 0) {
      radio.required = true;
    }
    label.appendChild(radio);
    
    const span = document.createElement('span');
    span.textContent = i;
    label.appendChild(span);
    
    scaleOptions.appendChild(label);
  }
  
  card.appendChild(scaleOptions);
  
  const legend = document.createElement('div');
  legend.className = 'scale-legend';
  legend.innerHTML = '<span>Worst</span><span>Best</span>';
  card.appendChild(legend);
  
  return card;
}

/**
 * Initialize progress tracking
 */
function initializeProgressTracking() {
  const radios = document.querySelectorAll('input[type="radio"]');
  radios.forEach(radio => {
    radio.addEventListener('change', updateProgress);
  });
  
  updateProgress();
}

/**
 * Update progress bar based on completed questions
 */
function updateProgress() {
  const form = document.getElementById('reviewForm');
  const radioGroups = {};
  const radios = form.querySelectorAll('input[type="radio"]');
  
  radios.forEach(radio => {
    if (!radioGroups[radio.name]) {
      radioGroups[radio.name] = false;
    }
    if (radio.checked) {
      radioGroups[radio.name] = true;
    }
  });
  
  const totalGroups = Object.keys(radioGroups).length;
  const completedGroups = Object.values(radioGroups).filter(v => v).length;
  const percentage = totalGroups > 0 ? Math.round((completedGroups / totalGroups) * 100) : 0;
  
  document.getElementById('progressFill').style.width = percentage + '%';
  document.getElementById('progressText').textContent = percentage + '% Complete';
}

/**
 * Show error message
 */
function showError(message) {
  document.getElementById('loadingMessage').style.display = 'none';
  const errorDiv = document.getElementById('errorMessage');
  errorDiv.textContent = '‚ùå ' + message;
  errorDiv.style.display = 'block';
}

/**
 * Form submission handler
 */
document.getElementById('reviewForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  // Collect form data
  const formData = new FormData(this);
  const data = {};
  
  for (let [key, value] of formData.entries()) {
    data[key] = value;
  }
  
  // Here you would typically send the data to a server or Firebase
  // For now, we'll log it and show a success message
  console.log('Form Data:', data);
  
  // Convert to JSON for potential export
  const jsonData = JSON.stringify(data, null, 2);
  console.log('JSON Format:', jsonData);
  
  // Show success message
  alert('‚úÖ Review submitted successfully!\n\nThank you for your evaluation.\n\nForm data has been logged to the browser console.');
  
  // Optionally download as JSON
  // downloadJSON(data);
  
  // Optionally reset the form
  // this.reset();
  // updateProgress();
});

/**
 * Optional: Download form data as JSON file
 */
function downloadJSON(data) {
  const json = JSON.stringify(data, null, 2);
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `xray-review-${new Date().toISOString().slice(0,10)}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>
